# é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œå„æ–‡ä»¶çš„ä½œç”¨ã€‚

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
stock_mcp_server/
â”‚
â”œâ”€â”€ mcp_server.py                    # ğŸš€ MCPæœåŠ¡å™¨ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ pyproject.toml                   # ğŸ“¦ é¡¹ç›®é…ç½®å’Œä¾èµ–ç®¡ç†
â”œâ”€â”€ README.md                        # ğŸ“– é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md                    # âš¡ å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ DEVELOPMENT.md                   # ğŸ‘¨â€ğŸ’» å¼€å‘è€…æ–‡æ¡£
â”œâ”€â”€ LICENSE                          # ğŸ“„ MITå¼€æºè®¸å¯è¯
â”œâ”€â”€ .env.example                     # ğŸ”‘ ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                       # ğŸš« Gitå¿½ç•¥æ–‡ä»¶é…ç½®
â”œâ”€â”€ test_basic.py                    # ğŸ§ª åŸºç¡€åŠŸèƒ½æµ‹è¯•è„šæœ¬
â”‚
â””â”€â”€ src/                             # ğŸ“‚ æ ¸å¿ƒæºä»£ç ç›®å½•
    â”œâ”€â”€ __init__.py                  # PythonåŒ…åˆå§‹åŒ–æ–‡ä»¶
    â”‚
    â”œâ”€â”€ data_source_interface.py     # ğŸ”Œ æ•°æ®æºæŠ½è±¡æ¥å£å®šä¹‰
    â”œâ”€â”€ stockapi_data_source.py      # ğŸ“¡ StockAPIæ•°æ®æºå…·ä½“å®ç°
    â”œâ”€â”€ utils.py                     # ğŸ› ï¸ é€šç”¨å·¥å…·å‡½æ•°
    â”‚
    â”œâ”€â”€ formatting/                  # ğŸ“Š æ•°æ®æ ¼å¼åŒ–æ¨¡å—
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ markdown_formatter.py    # Markdownæ ¼å¼åŒ–å·¥å…·
    â”‚
    â””â”€â”€ tools/                       # ğŸ”§ å·¥å…·æ¨¡å—ç›®å½•
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ stock_basic.py           # è‚¡ç¥¨åŸºç¡€ä¿¡æ¯å·¥å…·
        â”œâ”€â”€ stock_quotes.py          # è‚¡ç¥¨è¡Œæƒ…å·¥å…·
        â”œâ”€â”€ kline_data.py            # Kçº¿æ•°æ®å·¥å…·
        â”œâ”€â”€ financial_reports.py     # è´¢åŠ¡æŠ¥è¡¨å·¥å…·
        
        â””â”€â”€ date_utils.py            # æ—¥æœŸå·¥å…·
```

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### æ ¹ç›®å½•æ–‡ä»¶

#### `mcp_server.py` - ä¸»æœåŠ¡å™¨æ–‡ä»¶
- **ä½œç”¨**: MCPæœåŠ¡å™¨çš„å…¥å£ç‚¹
- **åŠŸèƒ½**:
  - åˆå§‹åŒ–æ•°æ®æº
  - æ³¨å†Œæ‰€æœ‰å·¥å…·æ¨¡å—
  - å¯åŠ¨MCPæœåŠ¡å™¨
  - å¤„ç†æœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸ
- **å…³é”®ä»£ç **:
  ```python
  active_data_source = StockAPIDataSource()
  app = FastMCP(...)
  app.run(transport='stdio')
  ```

#### `pyproject.toml` - é¡¹ç›®é…ç½®
- **ä½œç”¨**: å®šä¹‰é¡¹ç›®å…ƒæ•°æ®å’Œä¾èµ–
- **åŒ…å«**:
  - é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€æè¿°
  - Pythonç‰ˆæœ¬è¦æ±‚
  - ä¾èµ–åŒ…åˆ—è¡¨
  - æ„å»ºç³»ç»Ÿé…ç½®

#### `test_basic.py` - æµ‹è¯•è„šæœ¬
- **ä½œç”¨**: éªŒè¯åŸºæœ¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸
- **æµ‹è¯•é¡¹ç›®**:
  - æ•°æ®æºåˆå§‹åŒ–
  - è‚¡ç¥¨æœç´¢
  - è·å–è‚¡ç¥¨ä¿¡æ¯
  - Kçº¿æ•°æ®è·å–

### src/ ç›®å½•

#### `data_source_interface.py` - æ•°æ®æºæ¥å£
- **ä½œç”¨**: å®šä¹‰æ•°æ®æºçš„æŠ½è±¡æ¥å£
- **åŒ…å«æ–¹æ³•**:
  - `search_stock()` - æœç´¢è‚¡ç¥¨
  - `get_stock_basic_info()` - è·å–åŸºæœ¬ä¿¡æ¯
  - `get_kline_data()` - è·å–Kçº¿æ•°æ®
  - `get_financial_report()` - è·å–è´¢åŠ¡æŠ¥è¡¨
  - ç­‰ç­‰...
- **è®¾è®¡æ¨¡å¼**: æŠ½è±¡åŸºç±» (ABC)

#### `stockapi_data_source.py` - æ•°æ®æºå®ç°
- **ä½œç”¨**: å®ç° StockAPI æ•°æ®æº
- **åŠŸèƒ½**:
  - å®ç°æ‰€æœ‰æ¥å£æ–¹æ³•
  - HTTP API è°ƒç”¨
  - æ•°æ®è§£æå’Œè½¬æ¢
  - é”™è¯¯å¤„ç†
- **å…³é”®æ–¹æ³•**:
  - `_make_request()` - ç»Ÿä¸€APIè¯·æ±‚å¤„ç†
  - `_normalize_stock_code()` - æ ‡å‡†åŒ–è‚¡ç¥¨ä»£ç 

#### `utils.py` - å·¥å…·å‡½æ•°
- **ä½œç”¨**: æä¾›é€šç”¨å·¥å…·å‡½æ•°
- **åŠŸèƒ½**:
  - æ—¥å¿—é…ç½®
  - æ—¥æœŸæ ¼å¼åŒ–
  - æ•°å­—æ ¼å¼åŒ–
  - ç±»å‹è½¬æ¢

### src/formatting/ ç›®å½•

#### `markdown_formatter.py` - Markdownæ ¼å¼åŒ–
- **ä½œç”¨**: å°†æ•°æ®è½¬æ¢ä¸ºMarkdownæ ¼å¼
- **æä¾›æ–¹æ³•**:
  - `format_table()` - æ ¼å¼åŒ–è¡¨æ ¼
  - `format_key_value()` - æ ¼å¼åŒ–é”®å€¼å¯¹
  - `format_list()` - æ ¼å¼åŒ–åˆ—è¡¨
  - `format_section()` - æ ¼å¼åŒ–ç« èŠ‚

### src/tools/ ç›®å½•

æ¯ä¸ªå·¥å…·æ¨¡å—éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š

#### `stock_basic.py` - è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
- **å·¥å…·**:
  - `search_stock()` - æœç´¢è‚¡ç¥¨
  - `get_stock_info()` - è·å–è‚¡ç¥¨è¯¦æƒ…
  - `list_all_stocks()` - åˆ—å‡ºæ‰€æœ‰è‚¡ç¥¨

#### `stock_quotes.py` - è‚¡ç¥¨è¡Œæƒ…
- **å·¥å…·**:
  - `get_realtime_quote()` - è·å–å®æ—¶è¡Œæƒ…
  - `get_multiple_quotes()` - æ‰¹é‡è·å–è¡Œæƒ…

#### `kline_data.py` - Kçº¿æ•°æ®
- **å·¥å…·**:
  - `get_daily_kline()` - è·å–æ—¥Kçº¿
  - `get_weekly_kline()` - è·å–å‘¨Kçº¿
  - `get_monthly_kline()` - è·å–æœˆKçº¿

#### `financial_reports.py` - è´¢åŠ¡æŠ¥è¡¨
- **å·¥å…·**:
  - `get_financial_report()` - è·å–è´¢åŠ¡æŠ¥è¡¨
  - `compare_financial_reports()` - å¯¹æ¯”è´¢åŠ¡æŠ¥è¡¨

#### `date_utils.py` - æ—¥æœŸå·¥å…·
- **å·¥å…·**:
  - `get_latest_trading_date()` - è·å–æœ€æ–°äº¤æ˜“æ—¥
  - `get_trading_calendar()` - è·å–äº¤æ˜“æ—¥å†
  - `is_trading_day()` - åˆ¤æ–­æ˜¯å¦ä¸ºäº¤æ˜“æ—¥
  - `get_recent_trading_days()` - è·å–æœ€è¿‘äº¤æ˜“æ—¥
  - `get_market_analysis_timeframe()` - è·å–åˆ†ææ—¶é—´èŒƒå›´

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·è¯·æ±‚ (Claude Desktop)
    â†“
MCP Server (mcp_server.py)
    â†“
å·¥å…·å‡½æ•° (tools/*.py)
    â†“
æ•°æ®æºå®ä¾‹ (stockapi_data_source.py)
    â†“
StockAPI HTTP API
    â†“
è¿”å›æ•°æ®
    â†“
æ ¼å¼åŒ– (markdown_formatter.py)
    â†“
è¿”å›ç»™ç”¨æˆ·
```

## ğŸ¯ è®¾è®¡æ¨¡å¼

### 1. ä¾èµ–æ³¨å…¥
- æ•°æ®æºé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥åˆ°å·¥å…·æ¨¡å—
- æ˜“äºæµ‹è¯•å’Œæ›¿æ¢å®ç°

### 2. ç­–ç•¥æ¨¡å¼
- é€šè¿‡æ¥å£å®šä¹‰è¡Œä¸º
- ä¸åŒæ•°æ®æºå¯ä»¥æœ‰ä¸åŒå®ç°

### 3. å•ä¸€èŒè´£åŸåˆ™
- æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ç±»åŠŸèƒ½
- ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

### 4. å¼€é—­åŸåˆ™
- å¯¹æ‰©å±•å¼€æ”¾ï¼ˆæ·»åŠ æ–°å·¥å…·ï¼‰
- å¯¹ä¿®æ”¹å…³é—­ï¼ˆä¸éœ€è¦æ”¹åŠ¨æ ¸å¿ƒä»£ç ï¼‰

## ğŸ“¦ ä¾èµ–å…³ç³»

```
mcp_server.py
    â”œâ”€â†’ data_source_interface.py
    â”œâ”€â†’ stockapi_data_source.py
    â”œâ”€â†’ utils.py
    â””â”€â†’ tools/
         â”œâ”€â†’ stock_basic.py
         â”œâ”€â†’ stock_quotes.py
         â””â”€â†’ ...

tools/*.py
    â”œâ”€â†’ data_source_interface.py (æ¥å£ä¾èµ–)
    â”œâ”€â†’ formatting/markdown_formatter.py
    â””â”€â†’ utils.py

stockapi_data_source.py
    â””â”€â†’ data_source_interface.py (å®ç°æ¥å£)
```

## ğŸš€ æ‰©å±•ç‚¹

### æ·»åŠ æ–°æ•°æ®æº
1. åˆ›å»ºæ–°æ–‡ä»¶å®ç° `StockDataSource` æ¥å£
2. åœ¨ `mcp_server.py` ä¸­åˆ‡æ¢æ•°æ®æº

### æ·»åŠ æ–°å·¥å…·
1. åœ¨ `src/tools/` åˆ›å»ºæ–°æ¨¡å—
2. å®ç° `register_*_tools()` å‡½æ•°
3. åœ¨ `mcp_server.py` ä¸­æ³¨å†Œ

### æ·»åŠ æ–°æ ¼å¼åŒ–å™¨
1. åœ¨ `src/formatting/` æ·»åŠ æ–°æ ¼å¼åŒ–ç±»
2. åœ¨å·¥å…·ä¸­ä½¿ç”¨

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **Python æ–‡ä»¶**: 15+
- **å·¥å…·å‡½æ•°**: 20+
- **ä»£ç è¡Œæ•°**: 2000+
- **æ–‡æ¡£è¡Œæ•°**: 1000+

## ğŸ’¡ æœ€ä½³å®è·µ

1. âœ… æ‰€æœ‰å·¥å…·å‡½æ•°éƒ½æœ‰è¯¦ç»†çš„ docstring
2. âœ… ä½¿ç”¨ç±»å‹æç¤º (Type Hints)
3. âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
4. âœ… å®Œå–„çš„æ—¥å¿—è®°å½•
5. âœ… Markdownæ ¼å¼åŒ–è¾“å‡º
6. âœ… æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ¦‚è¿°
- [QUICKSTART.md](QUICKSTART.md) - å¿«é€Ÿå¼€å§‹
- [DEVELOPMENT.md](DEVELOPMENT.md) - å¼€å‘æŒ‡å—

---

**æç¤º**: è¿™ä¸ªé¡¹ç›®ç»“æ„è®¾è®¡ä½¿å¾—æ·»åŠ æ–°åŠŸèƒ½éå¸¸ç®€å•ï¼Œåªéœ€è¦ï¼š
1. å®šä¹‰æ¥å£æ–¹æ³•
2. å®ç°æ•°æ®è·å–
3. åˆ›å»ºå·¥å…·å‡½æ•°
4. æ³¨å†Œåˆ°ä¸»æœåŠ¡å™¨

æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼
